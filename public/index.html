<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>ChurnGuard - Restaurant Client Analytics</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="alternate icon" href="/favicon.svg" />
    <link rel="mask-icon" href="/favicon.svg" color="#0408e7" />
    <script type="module" crossorigin src="/assets/index-ltfxrxe4.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-DnLWzSlN.css">
    <style>
      /* Current month diagonal stripe overlay for Monthly Trends chart */
      .recharts-bar-rectangle[data-current-month="true"] {
        position: relative;
      }
      
      .recharts-bar-rectangle[data-current-month="true"]::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: repeating-linear-gradient(
          45deg,
          transparent,
          transparent 4px,
          rgba(255, 255, 255, 0.3) 4px,
          rgba(255, 255, 255, 0.3) 8px
        );
        pointer-events: none;
        z-index: 1;
      }
      
      /* Alternative approach using SVG patterns for better chart library compatibility */
      .current-month-stripes {
        background: repeating-linear-gradient(
          45deg,
          transparent,
          transparent 4px,
          rgba(255, 255, 255, 0.3) 4px,
          rgba(255, 255, 255, 0.3) 8px
        ) !important;
      }
      
      /* Pattern overlay for chart bars representing current month */
      .recharts-bar[data-current-month="true"] rect {
        mask: url(#diagonal-stripes);
        -webkit-mask: url(#diagonal-stripes);
      }
    </style>
  </head>
  <body>
    <!-- SVG patterns for current month diagonal stripes -->
    <svg width="0" height="0" style="position: absolute;">
      <defs>
        <pattern id="diagonal-stripes" patternUnits="userSpaceOnUse" width="8" height="8">
          <rect width="8" height="8" fill="transparent"/>
          <path d="M0,8 L8,0 M-2,2 L2,-2 M6,10 L10,6" stroke="rgba(255,255,255,0.3)" stroke-width="1.5"/>
        </pattern>
        
        <pattern id="highRiskStripe" patternUnits="userSpaceOnUse" width="8" height="8" patternTransform="rotate(45)">
          <rect width="8" height="8" fill="#dc2626"/>
          <rect width="4" height="8" fill="rgba(255,255,255,0.4)"/>
        </pattern>
        
        <pattern id="mediumRiskStripe" patternUnits="userSpaceOnUse" width="8" height="8" patternTransform="rotate(45)">
          <rect width="8" height="8" fill="#f59e0b"/>
          <rect width="4" height="8" fill="rgba(255,255,255,0.4)"/>
        </pattern>
        
        <pattern id="lowRiskStripe" patternUnits="userSpaceOnUse" width="8" height="8" patternTransform="rotate(45)">
          <rect width="8" height="8" fill="#10b981"/>
          <rect width="4" height="8" fill="rgba(255,255,255,0.4)"/>
        </pattern>
      </defs>
    </svg>
    
    <div id="root"></div>
    
    <!-- React and ReactDOM libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Dual Risk Component - Text Update Only -->
    <script src="/dual-risk-component.js"></script>
    
    <!-- CSS-only diagonal stripes for current month -->
    <style>
      /* Target the Monthly Trends chart specifically */
      .recharts-wrapper:nth-of-type(2) .recharts-bar-rectangle:last-child rect {
        background-image: repeating-linear-gradient(
          45deg,
          transparent,
          transparent 3px,
          rgba(255, 255, 255, 0.3) 3px,
          rgba(255, 255, 255, 0.3) 6px
        );
        mask: 
          repeating-linear-gradient(
            45deg,
            transparent,
            transparent 3px,
            black 3px,
            black 6px
          ),
          linear-gradient(black, black);
        mask-composite: subtract;
      }
      
      /* Alternative approach: Use CSS to add diagonal stripes overlay */
      .current-month-bars rect::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: repeating-linear-gradient(
          45deg,
          transparent,
          transparent 3px,
          rgba(255, 255, 255, 0.3) 3px,
          rgba(255, 255, 255, 0.3) 6px
        );
        pointer-events: none;
      }
    </style>
    
    <!-- Simple script to identify and mark current month bars -->
    <script>
      function markCurrentMonthBars() {
        try {
          console.log('ðŸŽ¯ Marking current month bars...');
          
          // Find all chart containers
          const allChartContainers = document.querySelectorAll('.recharts-wrapper');
          if (allChartContainers.length < 2) {
            console.log('âŒ Need at least 2 charts to identify Monthly Trends');
            return;
          }
          
          // Target the second chart (Monthly Trends)
          const monthlyTrendsChart = allChartContainers[1];
          console.log('âœ… Found Monthly Trends chart container');
          
          // Find all bar rectangles with colors (not grid/axis elements)
          const barRects = Array.from(monthlyTrendsChart.querySelectorAll('rect')).filter(rect => {
            const fill = rect.getAttribute('fill');
            return fill && fill !== 'none' && fill !== 'transparent' && !fill.includes('url(');
          });
          
          if (barRects.length === 0) {
            console.log('âŒ No colored bar rectangles found');
            return;
          }
          
          console.log(`ðŸ“Š Found ${barRects.length} colored bar rectangles`);
          
          // Group bars by x position to find months
          const barsByX = {};
          barRects.forEach(rect => {
            const x = parseFloat(rect.getAttribute('x') || 0);
            const fill = rect.getAttribute('fill');
            if (!barsByX[x]) barsByX[x] = [];
            barsByX[x].push({rect, fill});
          });
          
          const xPositions = Object.keys(barsByX).map(parseFloat).sort((a, b) => a - b);
          console.log(`ðŸ—“ï¸ Found ${xPositions.length} month positions`);
          
          if (xPositions.length === 0) return;
          
          // Get the rightmost month (current month)
          const currentMonthX = xPositions[xPositions.length - 1];
          const currentMonthBars = barsByX[currentMonthX];
          
          console.log(`ðŸŽ¯ Applying stripes to ${currentMonthBars.length} current month bars`);
          
          // Apply stripes by replacing fill with pattern
          currentMonthBars.forEach(({rect, fill}, index) => {
            let pattern = 'mediumRiskStripe'; // default
            
            // Map colors to the correct stripe pattern (using exact ChurnGuard 2.1 colors)
            if (fill === '#dc2626') {
              pattern = 'highRiskStripe';
            } else if (fill === '#f59e0b') {
              pattern = 'mediumRiskStripe'; 
            } else if (fill === '#10b981') {
              pattern = 'lowRiskStripe';
            }
            
            rect.style.fill = `url(#${pattern})`;
            rect.setAttribute('data-current-month', 'true');
            
            console.log(`  âœ… Applied ${pattern} to bar ${index} (was ${fill})`);
          });
          
          console.log(`ðŸŽ‰ Successfully applied diagonal stripes to current month`);
          
        } catch (error) {
          console.error('Error marking current month bars:', error);
        }
      }
      
      // Run when page loads
      document.addEventListener('DOMContentLoaded', () => {
        console.log('ðŸ“… DOM loaded, scheduling diagonal stripes...');
        setTimeout(markCurrentMonthBars, 1000);
        setTimeout(markCurrentMonthBars, 3000);
        setTimeout(markCurrentMonthBars, 5000);
      });
      
      // Also run when page is visible/focused
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden) {
          setTimeout(markCurrentMonthBars, 500);
        }
      });
      
      // Keep trying periodically
      let stripesInterval = setInterval(() => {
        const chartExists = document.querySelector('.recharts-wrapper');
        if (chartExists) {
          markCurrentMonthBars();
        }
      }, 8000); // Every 8 seconds
    </script>
    
    
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>